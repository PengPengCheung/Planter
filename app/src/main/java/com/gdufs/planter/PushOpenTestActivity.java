package com.gdufs.planter;

import android.content.Intent;
import android.os.Bundle;
import android.support.v7.app.AppCompatActivity;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.EditText;
import android.widget.TextView;
import android.widget.Toast;

import com.gdufs.planter.common.Resource;
import com.gdufs.planter.utils.NetworkUtil;
import com.gdufs.planter.utils.ResultCallback;

import org.json.JSONObject;

import java.util.HashMap;
import java.util.Map;

import cn.jpush.android.api.JPushInterface;
import me.drakeet.materialdialog.MaterialDialog;

/**
 * Created by peng on 2017/3/17.
 */

public class PushOpenTestActivity extends AppCompatActivity {

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        initDialog();
        TextView tv = new TextView(this);
        tv.setText("用户自定义打开的Activity");
        Intent intent = getIntent();
        if (null != intent) {
            Bundle bundle = intent.getExtras();
            String title = bundle.getString(JPushInterface.EXTRA_NOTIFICATION_TITLE);
            String content = bundle.getString(JPushInterface.EXTRA_ALERT);
            String push = bundle.getString("from");
            tv.setText("Title : " + title + "  " + "Content : " + content + "from: " + push);
            mMaterialDialog.show();
//            String push = intent.getStringExtra("from");
        }
        addContentView(tv, new ViewGroup.LayoutParams(ViewGroup.LayoutParams.FILL_PARENT, ViewGroup.LayoutParams.FILL_PARENT));
    }

    String inputCode = null;
    MaterialDialog mMaterialDialog;

    private void initDialog(){
        View view = LayoutInflater.from(this).inflate(R.layout.layout_dialog_postive, null);
        Button btnAttendanceCodeSubmit = (Button) view.findViewById(R.id.btn_dialog_positive);
        final EditText editCodeInput = (EditText) view.findViewById(R.id.ed_attendance_code_input);
//        editCodeInput.setOnClickListener(new View.OnClickListener() {
//            @Override
//            public void onClick(View v) {
//                if(null != editCodeInput.getText()){
//                    inputCode = editCodeInput.getText().toString();
//                }
//
//            }
//        });
        btnAttendanceCodeSubmit.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {

                if(null != editCodeInput.getText()){
                    inputCode = editCodeInput.getText().toString();
                }

                if(inputCode != null) {
                    if(inputCode.length() < 6 || inputCode.length() > 6) {
                        Toast.makeText(PushOpenTestActivity.this, "只能填写6位考勤码！", Toast.LENGTH_SHORT).show();
                        return;
                    }
                    Map<String, Object> params = new HashMap<String, Object>();
                    params.put("attendance", inputCode);
                    JSONObject json;
                    NetworkUtil.post(Resource.PlanterURL.ATTENDANCE_CODE_URL, params, new ResultCallback<String>() {
                        @Override
                        public void onSuccess(String response) {
                            Log.e("ppp", "response: " + response);
                        }

                        @Override
                        public void onFailure(Exception e) {
                            Log.e("ppp", "attendance fail.");
                        }
                    });
                }

                if(mMaterialDialog != null){
                    mMaterialDialog.dismiss();
                }
            }
        });
        mMaterialDialog = new MaterialDialog(this)
//                .setTitle("填写考勤码")
//                .setMessage(Resource.TEST_LONG_TEXT)
                .setContentView(view);
//                .setPositiveButton("OK", new View.OnClickListener() {
//                    @Override
//                    public void onClick(View v) {
//                        mMaterialDialog.dismiss();
//                    }
//                });
//                .setNegativeButton("CANCEL", new View.OnClickListener() {
//                    @Override
//                    public void onClick(View v) {
//                        mMaterialDialog.dismiss();
//                    }
//                });



//// You can change the message anytime. before show
//        mMaterialDialog.setTitle("提示");
//        mMaterialDialog.show();
//// You can change the message anytime. after show
//        mMaterialDialog.setMessage("你好，世界~");
    }
}
